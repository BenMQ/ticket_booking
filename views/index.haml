%dl.sub-nav
    %dt >>
    %dd.active
        %a{:href => "#"}订单 | Order Form
    %dd 
        %a{:href => "/payment.html"}付款方式 | Payment Instructions
%hr/
.row
    .seven.columns
        %form{:action => "/submit", :method => "POST", :id => "form"}
            %fieldset
                %legend 个人信息 Personal Information
                .row
                    .six.columns
                        %label 姓名 Name *
                        %input{:type => "text", :name => "name"}
                        %small.error{:style => "display:none"}必填 | Required
                    .six.columns
                .row
                    .six.columns
                        %label 电子邮箱 Email *
                        %input{:type => "text", :name => "email"}
                        %small.error{:style => "display:none"}无效邮箱地址 | Invalid address
                    .six.columns
                        %label 联系电话 Phone number *
                        %input{:type => "text", :name => 'phone'}
                        %small.error{:style => "display:none"}必填 | Required
                .row
                    .six.columns
                        %label 学校 School
                        %input{:type => "text", :name => "school"}
                    .six.columns
                        %label 宿舍 Hostel
                        %input{:type => "text", :name => "hostel"}
                %label 地址 Address
                %input{:type => "text", :name => "address1", :placeholder => "第一行 Line 1"}
                %input{:type => "text", :name => "address2", :placeholder => "第二行 Line 2"}
                .row.collapse
                    .two.mobile-one.columns
                        %span.prefix Singapore
                    .four.mobile-two.columns
                        %input{:type => "text", :name => "zip", :placeholder => "邮区编号 Postal code"}
                    .six.mobile-one.columns
                %br/

            %fieldset
                %legend 订票详情 Order details
                .row
                    .four.columns
                        %label 17 May, Friday
                        %input{:type => "text", :name => "ticket1", :placeholder => "张数 No. of tickets"}
                        %small.error{:style => "display:none"}
                            :escaped
                                > < 真的不买一张吗？
                    .four.columns
                        %label 18 May, Saturday
                        %input{:type => "text", :name => "ticket2", :placeholder => "张数 No. of tickets"}
                        %small.error{:style => "display:none"} 
                            :escaped
                                > < Please...
                    .four.columns
                        %label 19 May, Sunday
                        %input{:type => "text", :name => "ticket3", :placeholder => "张数 No. of tickets"}
                        %small.error{:style => "display:none"} 
                            :escaped
                                > < at least buy 1 ticket...
                %label 支付方式 Mode of payment
                %label
                    %input{:type => "radio", :name => "payment_method", :checked => 'true', :value => "cash"}
                    现金 Cash
                %label
                    %input{:type => "radio", :name => "payment_method", :value => "paypal"}
                    Paypal (~$20)
                %label
                    %input{:type => "radio", :name => "payment_method", :value => "alipay"}
                    支付宝 Alipay (~￥98)
                %label
                    %input{:type => "radio", :name => "payment_method", :value => "bank"}
                    银行转账 Fund Transfer (DBS/POSB)
                %br/
                %br/
                %label 备注 Notes
                %textarea{:name => "note"}
            %h6.subheader

                您可以在4月1日之前更改订票日期。4月1日之后我们将不接受日期更改的要求。
                %br/
                You may change the dates before 1 April. No requests will be accepted after that.
            %input.button{:type =>"submit", :value => "提交 Submit", :id => "submit"}
            %label.error{:style => "display:none", :id => "error-flag"} 请检查必填项目 | Please check the required fields.

    .five.columns
        .panel
            %h4 
                %small 我们的演出地点是：
                %br/
                %small We will be performing at:
                %br/
                %small Drama Centre,
                %br/
                %small 100 Victoria Street,
                %br/
                %small Level 3, National Library Building
                %br/
                %br/
                %small 现已开始预售理想国计划2013年以下三场演出的门票，预售票单价为$19：
            %ul.square
                %li 2013年5月17日 周五
                %li 2013年5月18日 周六
                %li 2013年5月19日 周日
            
            %h4
                %small 欢迎预订，您可以选择现金付款，也可以选择其他几种网络付款方式。部分服务商可能会收取手续费。
                %br/
                %small 提交成功后，我们将会向您发送确认邮件供您留存。
                %br/
                %small 如果您在10分钟后仍未收到邮件（请先检查垃圾邮件箱），或有任何疑问或意见，请联系
                %br/
                %small
                    %a{:href => "mailto:tickets@facultyofcreativity.org"} tickets@facultyofcreativity.org

            %h4
                %small Pre-ordering of the following three shows of Project Republica 2013 is now open, ticket price is $19 each
            %ul.square
                %li 17 May 2013, Friday
                %li 18 May 2013, Saturday
                %li 19 May 2013, Sunday
            %h4
                %small You may chooes to pay by cash or other online payment methods. Note that some service providers may charge transaction fees.
                %br/
                %small Once we receive your order, we will send you an confirmation email for your reference.
                %br/
                %small If you do not receive our email within 10 minutes (remember to check your spambox), or should you have any enquiries or comments, feel free to write to us at
                %br/
                %small
                    %a{:href => "mailto:tickets@facultyofcreativity.org"} tickets@facultyofcreativity.org

:javascript
    // very easy-to-break validation code
    // You really should not be looking into here. Anyway... if you really want to do silly things... I can't stop you. 
    function IsEmail(email) {
        var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }

    $(function(){
        $('input[name=name]').focus();
        $('#form').submit(function(e){
            function signal(dom) {
                dom.addClass('error');
                dom.prev().addClass('error');
                dom.next().show()
            }

            function deSignal(dom) {
                dom.removeClass('error');
                dom.prev().removeClass('error');
                dom.next().hide();
            }

            var flag = true;
            if ($('input[name=name]').val() === "") {
                flag = false;
                signal($('input[name=name]'));
            } else {
                deSignal($('input[name=name]'));
            }

            if (!IsEmail($('input[name=email]').val())) {
                flag = false;
                signal($('input[name=email]'));
            } else {
                deSignal($('input[name=email]'));
            }

            if ($('input[name=phone]').val() === "") {
                flag = false;
                signal($('input[name=phone]'));
            } else {
                deSignal($('input[name=phone]'));
            }

            var tix1 = parseInt($('input[name=ticket1]').val());
            var tix2 = parseInt($('input[name=ticket2]').val());
            var tix3 = parseInt($('input[name=ticket3]').val());
            if (isNaN(tix1)) {
                tix1 = 0;
            }
            if (isNaN(tix2)) {
                tix2 = 0;
            }
            if (isNaN(tix3)) {
                tix3 = 0;
            }
            if (tix1 + tix2 + tix3 === 0) {
                flag = false;
                signal($('input[name=ticket1]'));
                signal($('input[name=ticket2]'));
                signal($('input[name=ticket3]'));
            } else {
                deSignal($('input[name=ticket1]'));
                deSignal($('input[name=ticket2]'));
                deSignal($('input[name=ticket3]'));
            }

            if (flag) {
                if (!confirm("请确认您的邮箱地址是否正确：\n"+$('input[name=email]').val())) {
                    $('input[name=email]').focus();
                    e.preventDefault();
                } else {
                    $('#error-flag').hide();
                    $('#submit').val('提交中... Submitting...').addClass('secondary').attr('disabled', true);
                }
            } else {
                $('#error-flag').show();
                $(document).scrollTop($("#form").offset().top);
                e.preventDefault();
            }
        })
    });