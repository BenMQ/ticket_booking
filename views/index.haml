%dl.sub-nav
    %dt >>
    %dd.active
        %a{:href => "#"}订单 | Order Form
    %dd
        %a{:href => "/payment.html"}付款方式 | Payment Instructions
    %dd
        %a{:href => "http://www.sistic.com.sg/portal/dt?contentCode=proj0513"} | SISTIC 售票页面 | Event Page on SISTIC 
%hr/
.row
    .seven.columns
        %form{:action => "/submit", :method => "POST", :id => "form"}
            %fieldset
                %legend 个人信息 Personal Information
                .row
                    .six.columns
                        %label 姓名 Name *
                        %input{:type => "text", :name => "name"}
                        %small.error{:style => "display:none"}必填 | Required
                    .six.columns
                        %label IC/FIN/Passport *
                        %input{:type => "text", :name => "ic", :placeholder => "For verification"}
                        %small.error{:style => "display:none"}必填 | Required
                .row
                    .six.columns
                        %label 电子邮箱 Email *
                        %input{:type => "text", :name => "email"}
                        %small.error{:style => "display:none"}无效邮箱地址 | Invalid address
                    .six.columns
                        %label 联系电话 Phone number *
                        %input{:type => "text", :name => 'phone'}
                        %small.error{:style => "display:none"}必填 | Required
                .row
                    .six.columns
                        %label 学校 School
                        %input{:type => "text", :name => "school"}
                    .six.columns
                        %label 宿舍 Hostel
                        %input{:type => "text", :name => "hostel"}
                %br/

            %fieldset
                %legend 订票详情 Order details
                .row
                    .six.columns
                        %label 购票类别 Ticket Category †
                        %label
                            %input{:type => "radio", :name => "cat", :checked => 'true', :value => "Public", :"data-price" => "28"}
                            公众 Public $25.00 + 3.00 
                        %label
                            %input{:type => "radio", :name => "cat", :value => "Student", :"data-price" => "21"}
                            学生 Student $20.00 + 1.00
                    .six.columns
                        %label 总价 Total
                        %h4.subheader#total
                            $0.00
                %br/
                .row
                    .six.columns
                        %label 17 May, Friday 7:30pm
                        %input{:type => "text", :name => "ticket1", :class => "tix", :placeholder => "张数 No. of tickets"}
                        %small.error{:style => "display:none"}
                            :escaped
                                > < 真的不买一张吗？
                .row
                    .six.columns
                        %label 18 May, Saturday 2:30pm ‡
                        %input{:type => "text", :name => "ticket2", :class => "tix", :placeholder => "张数 No. of tickets"}
                        %small.error{:style => "display:none"}
                            :escaped
                                > < Please...  
                .row   
                    .six.columns
                        %label 19 May, Sunday 2:30pm
                        %input{:type => "text", :name => "ticket3", :class => "tix", :placeholder => "张数 No. of tickets"}
                        %small.error{:style => "display:none"} 
                            :escaped
                                > < at least buy 1 ticket...
                %label 支付方式 Mode of payment
                %label
                    %input{:type => "radio", :name => "payment_method", :checked => 'true', :value => "cash"}
                    现金 Cash
                %label
                    %input{:type => "radio", :name => "payment_method", :value => "paypal"}
                    Paypal (Transaction fees may apply)
                %label
                    %input{:type => "radio", :name => "payment_method", :value => "alipay"}
                    支付宝 Alipay 
                %label
                    %input{:type => "radio", :name => "payment_method", :value => "bank"}
                    银行转账 Fund Transfer (DBS/POSB)
                %br/
                %br/
                %label 备注 Notes
                %textarea{:name => "note"}
            %h6.subheader

                † 只有持有新加坡学生证的观众方能享受学生优惠票价。现场工作人员会进行检查。无法提供学生身份证明的观众将需要补足全额票款。
                %br/
                † Only full time students with valid student pass may purchase student concession tickets. Checks on concession tickets will be conducted at the point of entry. Patrons unable to present proof of eligibility are required to upgrade their concession tickets to full price tickets.
                %br/
                %br/
                ‡ 如果在5月10日前标注†的场次观众人数少于60人，主办方将取消场次。若场次取消，您可以在5月11日至16日换票至仍有空位的其他场次。
                %br/
                ‡ FC will cancel the performance denoted with † if no more than 60 seats are sold by 10 May. In the event that it is cancelled, you may change your ticket to another show between 11 May to 16 May (subject to availability). 
                

            
            %input.button{:type =>"submit", :value => "提交 Submit", :id => "submit"}
            %label.error{:style => "display:none", :id => "error-flag"} 请检查必填项目 | Please check the required fields.

    .five.columns
        .panel
            %h4
                %small 我们的演出地点是： 
                %br/
                %small We will be performing at:
                %br/
                %small Drama Centre Black Box,
                %br/
                %small 100 Victoria Street,
                %br/
                %small National Library Building
                %br/
                %br/
                %small 现已开始代售理想国计划2013年以下3场演出的门票：
            %ul.square
                %li 2013年5月17日 周五 7:30pm
                %li 2013年5月18日 周六 2:30pm ‡
                %li 2013年5月19日 周日 2:30pm 
            
            %h4
                %small 欢迎预订，您可以选择现金付款，也可以选择其他几种网络付款方式。部分服务商可能会收取手续费。
                %br/
                %small 提交成功后，我们将会向您发送确认邮件供您留存。
                %br/
                %small 如果您在10分钟后仍未收到邮件（请先检查垃圾邮件箱），或有任何疑问或意见，请联系
                %br/
                %small
                    %a{:href => "mailto:tickets@facultyofcreativity.org"} tickets@facultyofcreativity.org

            %h4
                %small Ordering of the following 3 shows of Project Republica 2013 is now open.
            %ul.square
                %li 17 May 2013, Friday 7:30pm
                %li 18 May 2013, Saturday 2:30pm ‡
                %li 19 May 2013, Sunday 2:30pm 
            %h4
                %small You may choose to pay by cash or other online payment methods. Note that some service providers may charge transaction fees.
                %br/
                %small Once we receive your order, we will send you an confirmation email for your reference.
                %br/
                %small If you do not receive our email within 10 minutes (remember to check your spambox), or should you have any enquiries or comments, feel free to write to us at
                %br/
                %small
                    %a{:href => "mailto:tickets@facultyofcreativity.org"} tickets@facultyofcreativity.org

:javascript
    // very easy-to-break validation code
    // You really should not be looking into here. Anyway... if you really want to do silly things... I can't stop you. 
    function IsEmail(email) {
        var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }
    var price = 28;
    $(function(){
        $('input[name=name]').focus();
        function updatePrice(){
            var tix1 = parseInt($('input[name=ticket1]').val());
            var tix2 = parseInt($('input[name=ticket2]').val());
            var tix3 = parseInt($('input[name=ticket3]').val());
            if (isNaN(tix1)) {
                tix1 = 0;
            }
            if (isNaN(tix2)) {
                tix2 = 0;
            }
            if (isNaN(tix3)) {
                tix3 = 0;
            }
            var total = (tix1+tix2+tix3) * price;
            $('#total').text("$"+total+".00");
        }
        
        $('input[name=cat]').click(function(e){
            price = +$(this).data('price');
            updatePrice();
        });
        $('.tix').keyup(updatePrice);

        $('#form').submit(function(e){
            function signal(dom) {
                dom.addClass('error');
                dom.prev().addClass('error');
                dom.next().show()
            }

            function deSignal(dom) {
                dom.removeClass('error');
                dom.prev().removeClass('error');
                dom.next().hide();
            }

            var flag = true;
            if ($('input[name=name]').val() === "") {
                flag = false;
                signal($('input[name=name]'));
            } else {
                deSignal($('input[name=name]'));
            }
            if ($('input[name=ic]').val() === "") {
                flag = false;
                signal($('input[name=ic]'));
            } else {
                deSignal($('input[name=ic]'));
            }

            if (!IsEmail($('input[name=email]').val())) {
                flag = false;
                signal($('input[name=email]'));
            } else {
                deSignal($('input[name=email]'));
            }

            if ($('input[name=phone]').val() === "") {
                flag = false;
                signal($('input[name=phone]'));
            } else {
                deSignal($('input[name=phone]'));
            }

            var tix1 = parseInt($('input[name=ticket1]').val());
            var tix2 = parseInt($('input[name=ticket2]').val());
            var tix3 = parseInt($('input[name=ticket3]').val());
            //var tix5 = parseInt($('input[name=ticket5]').val());
            if (isNaN(tix1)) {
                tix1 = 0;
            }
            if (isNaN(tix2)) {
                tix2 = 0;
            }
            if (isNaN(tix3)) {
                tix3 = 0;
            }
            //if (isNaN(tix5)) {
            //    tix5 = 0;
            //} 
            
            if (tix1 + tix2 + tix3  === 0) {
                flag = false;
                signal($('input[name=ticket1]'));
                signal($('input[name=ticket2]'));
                signal($('input[name=ticket3]'));
                //signal($('input[name=ticket5]'));
            } else {
                deSignal($('input[name=ticket1]'));
                deSignal($('input[name=ticket2]'));
                deSignal($('input[name=ticket3]'));
                //deSignal($('input[name=ticket5]'));
            }

            if (flag) {
                if (!confirm("请确认您的邮箱地址是否正确：\n"+$('input[name=email]').val())) {
                    $('input[name=email]').focus();
                    e.preventDefault();
                } else {
                    $('#error-flag').hide();
                    $('#submit').val('提交中... Submitting...').addClass('secondary').attr('disabled', true);
                }
            } else {
                $('#error-flag').show();
                $(document).scrollTop($("#form").offset().top);
                e.preventDefault();
            }
        })
    });